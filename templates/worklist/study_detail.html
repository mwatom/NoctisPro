{% extends 'base.html' %}

{% block title %}Study Details - Noctis Pro PACS{% endblock %}

{% block extra_css %}
<style>
	.detail-container { padding: 16px; }
	.card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; }
	.card-header { padding: 16px; border-bottom: 1px solid var(--border-color); display:flex; justify-content: space-between; align-items:center; }
	.card-body { padding: 16px; }
	.grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
	.label { color: var(--text-secondary); font-size: 12px; }
	.value { font-weight: 600; }
	.section-title { font-weight: 600; margin-top: 12px; margin-bottom: 8px; }
	.chips { display:flex; flex-wrap:wrap; gap:6px; }
	.chip { border: 1px solid var(--border-color); border-radius: 999px; padding: 4px 10px; font-size: 12px; color: var(--text-secondary); }
	.btn-mini { padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-primary); font-size: 12px; display:inline-flex; align-items:center; gap:6px; }
	.btn-mini:hover { background: var(--accent-color); color: var(--primary-bg); }
</style>
{% endblock %}

{% block content %}
<div class="detail-container">
	<div class="card">
		<div class="card-header">
			<div>
				<div class="value">{{ study.patient.full_name }} • {{ study.accession_number }}</div>
				<div class="label">{{ study.study_date|date:"Y-m-d H:i" }} • {{ study.modality.code }} • {{ study.study_description }}</div>
			</div>
			<div class="d-flex gap-2">
				<a href="{% url 'worklist:study_list' %}" class="btn-mini"><i class="fas fa-arrow-left"></i> Back</a>
				<a href="{% url 'worklist:upload_attachment' study.id %}" class="btn-mini"><i class="fas fa-paperclip"></i> Attach</a>
				<a href="{% url 'dicom_viewer:web_viewer' %}?study_id={{ study.id }}" class="btn-mini"><i class="fas fa-eye"></i> View</a>
			</div>
		</div>
		<div class="card-body">
			<div class="grid">
				<div><div class="label">Patient ID</div><div class="value">{{ study.patient.patient_id }}</div></div>
				<div><div class="label">Status</div><div class="value">{{ study.status|title }}</div></div>
				<div><div class="label">Priority</div><div class="value">{{ study.priority|title }}</div></div>
				<div><div class="label">Facility</div><div class="value">{{ study.facility.name }}</div></div>
			</div>

			<div class="section-title">Attachments</div>
			<div class="chips">
				{% for a in attachments %}
					<a class="chip" href="{% url 'worklist:view_attachment' a.id %}">
						{% if a.file_type == 'pdf_document' %}<i class="fas fa-file-pdf"></i>{% elif a.file_type == 'image' %}<i class="fas fa-image"></i>{% elif a.file_type == 'dicom_study' %}<i class="fas fa-cubes"></i>{% else %}<i class="fas fa-paperclip"></i>{% endif %}
						&nbsp;{{ a.name|truncatechars:30 }}
					</a>
					<form method="post" action="{% url 'worklist:delete_attachment' a.id %}" class="d-inline ms-1">
						{% csrf_token %}
						<button type="submit" class="btn-mini" title="Delete"><i class="fas fa-trash"></i></button>
					</form>
				{% empty %}
					<span class="label">No attachments yet.</span>
				{% endfor %}
			</div>
		</div>
	</div>
</div>
{% endblock %}